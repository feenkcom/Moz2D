language: cpp
sudo: required

dist: trusty

cache:
  directories:
  - mozilla-central-52
  - patches
  - mozilla-build
  - build/mozilla-central-52

addons:
  homebrew:
    packages:
    - node
    - yasm
    - mercurial
    - cmake
    - gawk
    - ccache
    - autoconf@2.13
  apt:
    packages:
    - nodejs
    - yasm
    - autoconf2.13
    - libgtk2.0-dev
    - libgtk-3-dev
    - libgconf2-dev
    - libasound2-dev

jobs:
 include:
 - os: osx
   script:
    - ./build.sh
 - os: linux
   before_install:
    - sudo apt-get update;
    - curl -sL https://deb.nodesource.com/setup_7.x | sudo bash -;
    - sudo apt-get install nodejs yasm autoconf2.13;
    - sudo apt-get install libpulse-dev;
    - sudo apt-get install libxt-dev libxext-dev libxcb-shm0-dev libx11-xcb-dev;
    - sudo apt-get install mesa-common-dev libgl1-mesa-dev;
   script:
    - ./build.sh
 - os: windows
   script:
    - PowerShell -Command '$VerbosePreference = "Continue"' -Verbose
    - PowerShell -Command 'Set-ExecutionPolicy -ExecutionPolicy RemoteSigned' -Verbose
    - cmd /c PowerShell -File windows-toolkit.ps1 -Verbose 2>&1 | echo

deploy:
  skip_cleanup: true
  provider: script
  script: bash .travis.deploy.sh